
<!DOCTYPE html>
<html lang="eu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zenbaki Osoak / NÃºmeros Enteros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body { font-family: 'Outfit', sans-serif; background-color: #f8fafc; }
      body.font-arabic { font-family: 'Cairo', sans-serif; }
      .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
      .animate-in { animation: fadeIn 0.5s ease-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .animate-bounce-small { animation: bounceSmall 2s infinite; }
      @keyframes bounceSmall { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
      .elevator-card { background: linear-gradient(135deg, #3b82f6 0%, #4f46e5 100%); }
      
      /* Scrollbar hiding */
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
    
    <!-- Robust Import Map using Google's Official CDN for Firebase -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
    "firebase/database": "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <!-- ðŸ”´ðŸ”´ CONFIGURATION SECTION ðŸ”´ðŸ”´ -->
    <!-- Paste your keys here replacing 'null'. Keep the syntax exactly as shown in Firebase Console. -->
    <script>
      window.FIREBASE_CONFIG = {
  apiKey: "AIzaSyDKmSAA6FNEudrsrP5KMw13ah5ovX7lY2M",
  authDomain: "zenbaki-osoak.firebaseapp.com",
  databaseURL: "https://zenbaki-osoak-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zenbaki-osoak",
  storageBucket: "zenbaki-osoak.firebasestorage.app",
  messagingSenderId: "137265772416",
  appId: "1:137265772416:web:16e672aee402c3b4637365"
};;
      // Example:
      // window.FIREBASE_CONFIG = {
      //   apiKey: "AIza...",
      //   authDomain: "...",
      //   databaseURL: "...",
      //   projectId: "...",
      //   storageBucket: "...",
      //   messagingSenderId: "...",
      //   appId: "..."
      // };
    </script>

    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        ArrowRight, ArrowLeft, BookOpen, Calculator, Home, Layout, Star, Menu, X, 
        RefreshCw, CheckCircle, AlertCircle, Lightbulb, Snowflake, 
        Sun, ThumbsUp, ThumbsDown, Globe, Trophy, User, LogOut, Timer, Trash2,
        Eye, EyeOff, Check, AlertTriangle, Plus, Minus, BarChart2, Cloud, CloudOff
      } from 'lucide-react';
      
      // --- FIREBASE INITIALIZATION ---
      import { initializeApp } from 'firebase/app';
      import { getDatabase, ref, get, set, remove, update } from 'firebase/database';

      let db = null;
      let firebaseError = null;
      
      // Safely try to init firebase using the global config
      if (window.FIREBASE_CONFIG) {
        try {
            const app = initializeApp(window.FIREBASE_CONFIG);
            db = getDatabase(app);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase Init Error:", error);
            firebaseError = error.message;
            // We DO NOT alert the user here to avoid annoying popups.
            // The app will gracefully degrade to local storage.
        }
      }

      // --- STORAGE MANAGER ---
      const DB_KEY = 'zenbaki_osoak_users_v2';
      const DEVICE_ID_KEY = 'zenbaki_device_id';

      const StorageManager = {
        getDeviceId: () => {
           let did = localStorage.getItem(DEVICE_ID_KEY);
           if (!did) {
             did = 'dev-' + Math.random().toString(36).substr(2, 9);
             localStorage.setItem(DEVICE_ID_KEY, did);
           }
           return did;
        },

        getAllUsers: async () => {
          if (db) {
            try {
              const snapshot = await get(ref(db, 'users'));
              if (snapshot.exists()) {
                const data = snapshot.val();
                return Object.values(data);
              }
              return [];
            } catch (e) {
              console.error("Firebase Read Error:", e);
              // Fallback to local if read fails (e.g. permission denied or offline)
              return JSON.parse(localStorage.getItem(DB_KEY) || '[]');
            }
          } else {
            return JSON.parse(localStorage.getItem(DB_KEY) || '[]');
          }
        },

        saveLocal: (users) => {
          localStorage.setItem(DB_KEY, JSON.stringify(users));
        },

        register: async (username, password, ip, deviceId) => {
          if (username.toLowerCase() === 'admin') return { success: false, error: 'reserved' };
          
          const users = await StorageManager.getAllUsers();
          if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
            return { success: false, error: 'exists' };
          }
          
          const newUser = { 
            username, password, ip, deviceId, banned: false, scores: {} 
          };

          if (db) {
            try {
                await set(ref(db, 'users/' + username), newUser);
            } catch(e) {
                console.error("Firebase Write Error", e);
                // If cloud fails, fallback local so user is not stuck
                users.push(newUser);
                StorageManager.saveLocal(users);
            }
          } else {
            users.push(newUser);
            StorageManager.saveLocal(users);
          }
          return { success: true, user: newUser };
        },

        login: async (username, password, ip, deviceId) => {
          if (username === 'Admin' && password === 'Pepito232') {
             return { success: true, user: { username: 'Admin', isAdmin: true } };
          }

          const users = await StorageManager.getAllUsers();
          const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === password);
          
          if (user) {
             if (user.banned) return { success: false, error: 'banned' };
             
             const updatedUser = { ...user, ip, deviceId };
             if (db) {
                try {
                    await update(ref(db, 'users/' + user.username), { ip, deviceId });
                } catch(e) { console.error("Update Error", e); }
             } else {
                const idx = users.findIndex(u => u.username === user.username);
                users[idx] = updatedUser;
                StorageManager.saveLocal(users);
             }
             return { success: true, user: updatedUser };
          }
          return { success: false, error: 'cred' };
        },

        deleteUser: async (username) => {
          if (db) {
            try {
                await remove(ref(db, 'users/' + username));
                return true;
            } catch (e) { console.error("Del Error", e); return false; }
          } else {
            let users = await StorageManager.getAllUsers();
            const initLen = users.length;
            users = users.filter(u => u.username !== username);
            if (users.length < initLen) {
               StorageManager.saveLocal(users);
               return true;
            }
            return false;
          }
        },

        checkUserStatus: async (username) => {
          if (db) {
            try {
                const snapshot = await get(ref(db, 'users/' + username));
                if (!snapshot.exists()) return 'deleted';
                if (snapshot.val().banned) return 'banned';
                return 'ok';
            } catch(e) { return 'ok'; } // If offline, assume OK to not block user
          } else {
            const users = await StorageManager.getAllUsers();
            const u = users.find(u => u.username === username);
            if (!u) return 'deleted';
            if (u.banned) return 'banned';
            return 'ok';
          }
        },

        saveScore: async (username, gameId, score) => {
          const users = await StorageManager.getAllUsers();
          const user = users.find(u => u.username === username);
          if (!user) return { isNewRecord: false };

          const currentScore = user.scores?.[gameId] || 0;
          if (score > currentScore) {
             if (db) {
               try {
                  await update(ref(db, `users/${username}/scores`), { [gameId]: score });
               } catch(e) { console.error("Score Save Error", e); }
               // Also save local cache for speed
               return { isNewRecord: true, user: { ...user, scores: { ...user.scores, [gameId]: score } } };
             } else {
               user.scores = user.scores || {};
               user.scores[gameId] = score;
               StorageManager.saveLocal(users);
               return { isNewRecord: true, user };
             }
          }
          return { isNewRecord: false, user };
        }
      };

      // --- TRANSLATIONS ---
      const TRANSLATIONS = {
        eu: {
          title: "Zenbaki Osoak",
          intro_desc: "Mundu errealean, zenbakiak ez dira beti positiboak. Zorrak, hotza, eta sotoak adierazteko... negatiboak behar ditugu!",
          nav: { intro: "Zer dira?", line: "Ordena", ops: "Eragiketak", probs: "Problemak", games: "Jolastu", records: "Errekorrak", profile: "Profila" },
          auth: { login_title: "Sartu", register_title: "Erregistratu", user_ph: "Erabiltzailea", pass_ph: "Pasahitza", btn_login: "Sartu", btn_register: "Erregistratu", no_account: "Ez duzu konturik?", has_account: "Baduzu kontua?", error_exists: "Erabiltzailea existitzen da", error_reserved: "Izen hori ezin da erabili", error_cred: "Datuak okerrak dira", error_banned: "KONTUA BLOKEATUTA. Adminarekin hitz egin.", welcome: "Ongi etorri" },
          admin: { title: "Administrazio Panela", subtitle: "Erabiltzaileen kontrola eta segurtasuna", col_user: "Erabiltzailea", col_ip: "IP Helbidea", col_device: "ID Gailua", col_pass: "Pasahitza", col_score: "Markak (Ops/TF/Pyr)", col_status: "Egoera", col_actions: "Ekintzak", status_ok: "Aktibo", status_ban: "Kanporatua", btn_ban: "Kanporatu", btn_unban: "Onartu", btn_cancel: "Ezeztatu", no_users: "Ez dago erabiltzailerik sisteman.", logout: "Irten paneletik", confirm_ban: "Ziur erabiltzaile hau betirako ezabatu nahi duzula?", btn_leaderboards: "Ikusi Sailkapenak", lb_title: "Sailkapen Orokorra" },
          records: { title: "Errekorren Gela", subtitle: "1 minutu. Ahalik eta gehien asmatu. +1 Asmatu, -2 Huts egin.", start: "Hasi Erronka", time: "Denbora", score: "Puntuak", game_ops: "Nahasia", game_pyr: "Piramideak", game_tf: "Egia ala Gezurra", game_compare: "Konparatu", game_add: "Batuketak", game_sub: "Kenketak", game_mul: "Biderketak", game_combined: "Konbinatuak", new_record: "ERREKOR BERRIA!", final_score: "Amaierako Puntuazioa", leaderboard: "Top 3 Sailkapena", no_scores: "Oraindik ez dago markarik", back: "Itzuli", check: "Egiaztatu" },
          profile: { title: "Zure Profila", best_scores: "Marka Onenak", delete_acc: "Ezabatu Kontua", logout: "Saioa itxi", confirm_del: "Ziur zaude? Ezin da desegin." },
          thermometer: { title: "Tenperatura eta Zenbakiak", desc: "Termometroak zenbaki osoak ulertzeko balio du.", ref: "Zero (0) erreferentzia da.", pos: "Zerotik gora: Positiboak (+)", neg: "Zerotik behera: Negatiboak (-)", label: "Mugitu tenperatura:", above: "Zero gainetik", below: "Zero azpitik", zero: "Zero" },
          elevator: { title: "Igogailua", desc: "Eraikinetan, sotoak adierazteko zenbaki negatiboak erabiltzen ditugu.", floor0: "Behea", floor1: "1. Sotoa", floor_label: "Sol", basement_label: "Soto" },
          sets: { title: "Zenbaki multzoak", N: "N (Arruntak)", Z: "Z (Osoak)" },
          numberline: { title: "Zuzen Numerikoa", desc: "Egin klik zenbakietan. Eskuinean dauden zenbakiak beti handiagoak dira. Ezkerrean daudenak, txikiagoak.", neg: "Negatiboa", pos: "Positiboa", zero: "Zeroa", smaller: "Txikiagoak", bigger: "Handiagoak", hunt_title: "Non daude?", hunt_desc: "Idatzi letra bakoitzari dagokion zenbaki osoa.", check: "Egiaztatu" },
          ops: { title: "Eragiketak", subtitle: "Parentesiak kentzeko araua ikasi.", same: "BERDINAK", diff: "EZBERDINAK", hint_title: "Aholkua", hint: "Zeinu berdinak â†’ (+), Zeinu ezberdinak â†’ (-)", correct: "Zuzena! Bikain!", wrong: "Okerra... begiratu ondo zeinuak!", skip: "Saltatu", modes: { compare: "Konparatu", add: "Batuketak", subtract: "Kenketak", multiply: "Biderketak", combined: "Konbinatuak" } },
          problems: { title: "Problemak", subtitle: "Erabili zenbaki osoak eguneroko egoeretan.", rem_title: "Gogoratu!", rem_text: "\"Zorrak\", \"gastatu\" eta \"K.a.\" negatiboak dira. \"Irabazi\", \"eman\" eta \"K.o.\" positiboak dira.", label: "Problema", hint_btn: "Pistatxo bat nahi?", hint_prefix: "Pista", next: "Hurrengoa", check: "Egiaztatu", correct: "Zuzena! Oso ongi!", wrong: "Saiatu berriro..." },
          games: { title: "Jolas Gunea", subtitle: "Ikasi jolasten!", pyramid: { title: "Piramide Magikoa", desc: "Beheko bi laukien batura goikoa da." }, tf: { title: "Egia ala Gezurra?", true: "Egia", false: "Gezurra", streak: "Racha" }, memory: { title: "Bikoteak Bilatu", won: "Zorionak! Guztiak aurkitu dituzu!" } },
          footer: "Eremu Zientifiko Matematikoa - 1. DBH"
        },
        es: {
          title: "NÃºmeros Enteros",
          intro_desc: "En el mundo real, los nÃºmeros no siempre son positivos. Â¡Para las deudas, el frÃ­o y los sÃ³tanos... necesitamos negativos!",
          nav: { intro: "Â¿QuÃ© son?", line: "Orden", ops: "Operaciones", probs: "Problemas", games: "Jugar", records: "RÃ©cords", profile: "Perfil" },
          auth: { login_title: "Entrar", register_title: "Registrarse", user_ph: "Usuario", pass_ph: "ContraseÃ±a", btn_login: "Entrar", btn_register: "Crear cuenta", no_account: "Â¿No tienes cuenta?", has_account: "Â¿Ya tienes cuenta?", error_exists: "El usuario ya existe", error_reserved: "Nombre reservado", error_cred: "Datos incorrectos", error_banned: "CUENTA BLOQUEADA. Contacta al Admin.", welcome: "Bienvenido" },
          admin: { title: "Panel de AdministraciÃ³n", subtitle: "Control de usuarios y seguridad", col_user: "Usuario", col_ip: "DirecciÃ³n IP", col_device: "ID Dispositivo", col_pass: "ContraseÃ±a", col_score: "RÃ©cords", col_status: "Estado", col_actions: "Acciones", status_ok: "Activo", status_ban: "Expulsado", btn_ban: "Eliminar", btn_unban: "Readmitir", btn_cancel: "Cancelar", no_users: "No hay usuarios en el sistema.", logout: "Salir del panel", confirm_ban: "Â¿Seguro que quieres eliminar definitivamente a este usuario?", btn_leaderboards: "Ver Clasificaciones", lb_title: "ClasificaciÃ³n Global" },
          records: { title: "Sala de RÃ©cords", subtitle: "1 minuto. Acierta el mÃ¡ximo posible. +1 Acierto, -2 Fallo.", start: "Empezar Reto", time: "Tiempo", score: "Puntos", game_ops: "PopurrÃ­", game_pyr: "PirÃ¡mides", game_tf: "Verdadero o Falso", game_compare: "Comparar", game_add: "Sumas", game_sub: "Restas", game_mul: "Multiplicar", game_combined: "Combinadas", new_record: "Â¡NUEVO RÃ‰CORD!", final_score: "PuntuaciÃ³n Final", leaderboard: "Top 3 ClasificaciÃ³n", no_scores: "AÃºn no hay marcas", back: "Volver", check: "Comprobar" },
          profile: { title: "Tu Perfil", best_scores: "Mejores Marcas", delete_acc: "Borrar Cuenta", logout: "Cerrar SesiÃ³n", confirm_del: "Â¿Seguro? No se puede deshacer." },
          thermometer: { title: "Temperatura y NÃºmeros", desc: "El termÃ³metro sirve para entender los nÃºmeros enteros.", ref: "El cero (0) es la referencia.", pos: "Sobre cero: Positivos (+)", neg: "Bajo cero: Negativos (-)", label: "Mueve la temperatura:", above: "Sobre cero", below: "Bajo cero", zero: "Cero" },
          elevator: { title: "El Ascensor", desc: "En los edificios, usamos nÃºmeros negativos para los sÃ³tanos.", floor0: "Baja", floor1: "SÃ³tano 1", floor_label: "Piso", basement_label: "SÃ³t" },
          sets: { title: "Conjuntos numÃ©ricos", N: "N (Naturales)", Z: "Z (Enteros)" },
          numberline: { title: "Recta NumÃ©rica", desc: "Haz clic en los nÃºmeros. A la derecha siempre son mayores. A la izquierda, menores.", neg: "Negativo", pos: "Positivo", zero: "Cero", smaller: "Menores", bigger: "Mayores", hunt_title: "Â¿DÃ³nde estÃ¡n?", hunt_desc: "Escribe el nÃºmero entero correspondiente a cada letra.", check: "Comprobar" },
          ops: { title: "Operaciones", subtitle: "Aprende la regla para quitar parÃ©ntesis.", same: "IGUALES", diff: "DIFERENTES", hint_title: "Consejo", hint: "Signos iguales â†’ (+), Signos diferentes â†’ (-)", correct: "Â¡Correcto! Â¡Genial!", wrong: "Incorrecto... Â¡mira bien los signos!", skip: "Saltar", modes: { compare: "Comparar", add: "Sumas", subtract: "Restas", multiply: "Multiplicar", combined: "Combinadas" } },
          problems: { title: "Problemas", subtitle: "Usa los nÃºmeros enteros en situaciones cotidianas.", rem_title: "Â¡Recuerda!", rem_text: "\"Deudas\", \"gastar\" y \"A.C.\" son negativos. \"Ganar\", \"dar\" y \"D.C.\" son positivos.", label: "Problema", hint_btn: "Â¿Quieres una pista?", hint_prefix: "Pista", next: "Siguiente", check: "Comprobar", correct: "Â¡Correcto! Â¡Muy bien!", wrong: "IntÃ©ntalo de nuevo..." },
          games: { title: "Zona de Juegos", subtitle: "Â¡Aprende jugando!", pyramid: { title: "PirÃ¡mide MÃ¡gica", desc: "La suma de los dos bloques de abajo es el de arriba." }, tf: { title: "Â¿Verdadero o Falso?", true: "Verdadero", false: "Falso", streak: "Racha" }, memory: { title: "Buscar Parejas", won: "Â¡Felicidades! Â¡Las has encontrado todas!" } },
          footer: "Ãmbito CientÃ­fico MatemÃ¡tico - 1Âº ESO"
        },
        ar: {
          title: "Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµØ­ÙŠØ­Ø©",
          intro_desc: "ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„ÙŠØ³Øª Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…ÙˆØ¬Ø¨Ø©. Ù„Ù„Ø¯ÙŠÙˆÙ†ØŒ ÙˆØ§Ù„Ø¨Ø±Ø¯ØŒ ÙˆØ§Ù„Ø£Ù‚Ø¨ÙŠØ©... Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø¨ÙŠØ§Øª!",
          nav: { intro: "Ù…Ø§ Ù‡ÙŠØŸ", line: "Ø§Ù„ØªØ±ØªÙŠØ¨", ops: "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", probs: "Ù…Ø³Ø§Ø¦Ù„", games: "Ù„Ø¹Ø¨", records: "Ø£Ø±Ù‚Ø§Ù… Ù‚ÙŠØ§Ø³ÙŠØ©", profile: "Ù…Ù„Ù" },
          auth: { login_title: "Ø¯Ø®ÙˆÙ„", register_title: "ØªØ³Ø¬ÙŠÙ„", user_ph: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", pass_ph: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", btn_login: "Ø¯Ø®ÙˆÙ„", btn_register: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨", no_account: "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ", has_account: "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ", error_exists: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„", error_reserved: "Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø­Ø¬ÙˆØ²", error_cred: "Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©", error_banned: "Ø­Ø³Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ±. Ø§ØªØµÙ„ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.", welcome: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ" },
          admin: { title: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…", subtitle: "Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø£Ù…Ø§Ù†", col_user: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", col_ip: "Ø¹Ù†ÙˆØ§Ù† IP", col_device: "Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø²", col_pass: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", col_score: "Ø§Ù„Ù†ØªØ§Ø¦Ø¬", col_status: "Ø§Ù„Ø­Ø§Ù„Ø©", col_actions: "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª", status_ok: "Ù†Ø´Ø·", status_ban: "Ù…Ø·Ø±ÙˆØ¯", btn_ban: "Ø­Ø°Ù", btn_unban: "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±", btn_cancel: "Ø¥Ù„ØºØ§Ø¡", no_users: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†", logout: "Ø®Ø±ÙˆØ¬", confirm_ban: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ", btn_leaderboards: "Ø¹Ø±Ø¶ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª", lb_title: "Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ø§Ù…" },
          records: { title: "Ù‚Ø§Ø¹Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ©", subtitle: "Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©. Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯. +1 ØµØ­ÙŠØ­ØŒ -2 Ø®Ø·Ø£.", start: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ", time: "Ø§Ù„ÙˆÙ‚Øª", score: "Ø§Ù„Ù†Ù‚Ø§Ø·", game_ops: "Ù…Ø®ØªÙ„Ø·", game_pyr: "Ø£Ù‡Ø±Ø§Ù…Ø§Øª", game_tf: "ØµØ­ Ø£Ù… Ø®Ø·Ø£", game_compare: "Ù…Ù‚Ø§Ø±Ù†Ø©", game_add: "Ø¬Ù…Ø¹", game_sub: "Ø·Ø±Ø­", game_mul: "Ø¶Ø±Ø¨", game_combined: "Ù…Ø®ØªÙ„Ø·Ø©", new_record: "Ø±Ù‚Ù… Ù‚ÙŠØ§Ø³ÙŠ Ø¬Ø¯ÙŠØ¯!", final_score: "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©", leaderboard: "Ø£ÙØ¶Ù„ 3 Ù…Ø±Ø§ÙƒØ²", no_scores: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†", back: "Ø±Ø¬ÙˆØ¹", check: "ØªØ­Ù‚Ù‚" },
          profile: { title: "Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ", best_scores: "Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬", delete_acc: "Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨", logout: "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬", confirm_del: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹." },
          thermometer: { title: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", desc: "Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ÙÙ‡Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµØ­ÙŠØ­Ø©.", ref: "Ø§Ù„ØµÙØ± (0) Ù‡Ùˆ Ø§Ù„Ù…Ø±Ø¬Ø¹.", pos: "ÙÙˆÙ‚ Ø§Ù„ØµÙØ±: Ù…ÙˆØ¬Ø¨ (+)", neg: "ØªØ­Øª Ø§Ù„ØµÙØ±: Ø³Ø§Ù„Ø¨ (-)", label: "Ø­Ø±Ùƒ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:", above: "ÙÙˆÙ‚ Ø§Ù„ØµÙØ±", below: "ØªØ­Øª Ø§Ù„ØµÙØ±", zero: "ØµÙØ±" },
          elevator: { title: "Ø§Ù„Ù…ØµØ¹Ø¯", desc: "ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø³Ø§Ù„Ø¨Ø© Ù„Ù„Ø£Ù‚Ø¨ÙŠØ©.", floor0: "Ø£Ø±Ø¶ÙŠ", floor1: "Ù‚Ø¨Ùˆ 1", floor_label: "Ø·Ø§Ø¨Ù‚", basement_label: "Ù‚Ø¨Ùˆ" },
          sets: { title: "Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯", N: "N (Ø·Ø¨ÙŠØ¹ÙŠØ©)", Z: "Z (ØµØ­ÙŠØ­Ø©)" },
          numberline: { title: "Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯", desc: "Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…. Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø£ÙƒØ¨Ø±. ÙˆØ¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ø£ØµØºØ±.", neg: "Ø³Ø§Ù„Ø¨", pos: "Ù…ÙˆØ¬Ø¨", zero: "ØµÙØ±", smaller: "Ø£ØµØºØ±", bigger: "Ø£ÙƒØ¨Ø±", hunt_title: "Ø£ÙŠÙ† Ù‡Ù…ØŸ", hunt_desc: "Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØµØ­ÙŠØ­ Ø§Ù„Ù…ÙˆØ§ÙÙ‚ Ù„ÙƒÙ„ Ø­Ø±Ù.", check: "ØªØ­Ù‚Ù‚" },
          ops: { title: "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", subtitle: "ØªØ¹Ù„Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ù‚ÙˆØ§Ø³.", same: "Ù…ØªØ´Ø§Ø¨Ù‡Ø©", diff: "Ù…Ø®ØªÙ„ÙØ©", hint_title: "Ù†ØµÙŠØ­Ø©", hint: "Ø¥Ø´Ø§Ø±Ø§Øª Ù…ØªØ´Ø§Ø¨Ù‡Ø© â† (+)ØŒ Ø¥Ø´Ø§Ø±Ø§Øª Ù…Ø®ØªÙ„ÙØ© â† (-)", correct: "ØµØ­ÙŠØ­! Ø±Ø§Ø¦Ø¹!", wrong: "Ø®Ø·Ø£... Ø§Ù†Ø¸Ø± Ø¬ÙŠØ¯Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª!", skip: "ØªØ®Ø·Ù‰", modes: { compare: "Ù…Ù‚Ø§Ø±Ù†Ø©", add: "Ø¬Ù…Ø¹", subtract: "Ø·Ø±Ø­", multiply: "Ø¶Ø±Ø¨", combined: "Ù…Ø®ØªÙ„Ø·Ø©" } },
          problems: { title: "Ù…Ø³Ø§Ø¦Ù„", subtitle: "Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµØ­ÙŠØ­Ø© ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.", rem_title: "ØªØ°ÙƒØ±!", rem_text: "\"Ø§Ù„Ø¯ÙŠÙˆÙ†\"ØŒ \"Ø¥Ù†ÙØ§Ù‚\" Ùˆ \"Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯\" Ø³Ù„Ø¨ÙŠØ©. \"ÙƒØ³Ø¨\"ØŒ \"Ø¥Ø¹Ø·Ø§Ø¡\" Ùˆ \"Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯\" Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©.", label: "Ù…Ø³Ø£Ù„Ø©", hint_btn: "Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙ„Ù…ÙŠØ­Ø§Ù‹ØŸ", hint_prefix: "ØªÙ„Ù…ÙŠØ­", next: "Ø§Ù„ØªØ§Ù„ÙŠ", check: "ØªØ­Ù‚Ù‚", correct: "ØµØ­ÙŠØ­! Ø£Ø­Ø³Ù†Øª!", wrong: "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰..." },
          games: { title: "Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨", subtitle: "ØªØ¹Ù„Ù… Ø¨Ø§Ù„Ù„Ø¹Ø¨!", pyramid: { title: "Ø§Ù„Ù‡Ø±Ù… Ø§Ù„Ø³Ø­Ø±ÙŠ", desc: "Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¨Ø¹ÙŠÙ† Ø§Ù„Ø³ÙÙ„ÙŠÙŠÙ† ÙŠØ³Ø§ÙˆÙŠ Ø§Ù„Ø¹Ù„ÙˆÙŠ." }, tf: { title: "ØµØ­ Ø£Ù… Ø®Ø·Ø£ØŸ", true: "ØµØ­", false: "Ø®Ø·Ø£", streak: "Ù…ØªØªØ§Ù„ÙŠØ©" }, memory: { title: "Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø²ÙˆØ§Ø¬", won: "Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ ÙˆØ¬Ø¯Øª Ø§Ù„Ø¬Ù…ÙŠØ¹!" } },
          footer: "Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ - Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ"
        }
      };

      // --- MATH LOGIC ---
      const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
      const fmt = (n) => n < 0 ? `(${n})` : `${n}`;

      // 1. Operations & Smart Distractors
      const generateOperation = (type, lang) => {
        let question = '', answer = 0;
        if (type === 'combined') {
          const subtype = randomInt(1, 3);
          const a = randomInt(-6, 6), b = randomInt(-6, 6), c = randomInt(-5, 5);
          if (subtype === 1) { 
              // a + b * c
              question = `${fmt(a)} + ${fmt(b)} Â· ${fmt(c)}`; 
              answer = a + (b * c); 
          } else if (subtype === 2) { 
              // (a + b) * c
              question = `(${a} + ${fmt(b)}) Â· ${fmt(c)}`; 
              answer = (a + b) * c; 
          } else { 
              // a - b - c
              question = `${fmt(a)} - ${fmt(b)} - ${fmt(c)}`; 
              answer = a - b - c; 
          }
        } else {
          let a = randomInt(-10, 10), b = randomInt(-10, 10);
          if (type === 'add') { question = `${a} + (${b})`; answer = a + b; }
          else if (type === 'subtract') { question = `${a} - (${b})`; answer = a - b; }
          else if (type === 'multiply') { question = `${a} Â· (${b})`; answer = a * b; }
        }
        
        // Smart Distractors
        const options = [answer];
        // 1. Sign Error
        if (answer !== 0 && !options.includes(-answer)) options.push(-answer);
        
        // 2. Operation Error
        if (type === 'subtract' || (type === 'combined' && question.includes('-'))) {
             if (!options.includes(0)) options.push(0);
        }

        while (options.length < 4) {
          let fake;
          const r = Math.random();
          if (r < 0.33) fake = answer + randomInt(-5, 5);
          else if (r < 0.66) fake = randomInt(-20, 20);
          else fake = answer + (Math.random() > 0.5 ? 10 : -10);

          if (fake !== answer && !options.includes(fake)) options.push(fake);
        }
        return { id: Math.random().toString(), question, correctAnswer: answer, options: options.sort(() => Math.random() - 0.5), type };
      };

      const generateComparison = () => {
         const a = randomInt(-20, 20); let b = randomInt(-20, 20);
         while (a === b) b = randomInt(-20, 20);
         return { id: Math.random().toString(), question: `> ? <`, correctAnswer: Math.max(a, b), options: [a, b], type: 'compare' };
      };

      const generateTrueFalse = () => {
         const type = randomInt(1, 2);
         if (type === 1) {
             const a = randomInt(-10, 10), b = randomInt(-10, 10);
             if (a===b) return generateTrueFalse();
             const sym = Math.random() > 0.5 ? '>' : '<';
             return { id: Math.random().toString(), statement: `${a} ${sym} ${b}`, isTrue: sym === '>' ? a > b : a < b, explanation: `${a} ${sym==='>' ? (a>b?'HANDIA da':'EZ da handia') : (a<b?'TXIKIA da':'EZ da txikia')} ${b} baino` };
         } else {
             const a = randomInt(-8, 8), b = randomInt(-8, 8), res = a+b;
             const shown = Math.random() > 0.5 ? res : res + randomInt(-3, 3);
             return { id: Math.random().toString(), statement: `${fmt(a)} + ${fmt(b)} = ${shown===res && Math.random()>0.5 ? res+1 : shown}`, isTrue: shown === res, explanation: `${fmt(a)} + ${fmt(b)} = ${res}` };
         }
      };

      const generatePyramid = () => {
         const c=randomInt(-5,5), d=randomInt(-5,5), e=randomInt(-5,5);
         const a=c+d, b=d+e, top=a+b;
         const cells=[{id:'top',value:top,isInput:Math.random()>0.5,row:0,col:0},{id:'a',value:a,isInput:Math.random()>0.5,row:1,col:0},{id:'b',value:b,isInput:Math.random()>0.5,row:1,col:1},{id:'c',value:c,isInput:Math.random()>0.5,row:2,col:0},{id:'d',value:d,isInput:Math.random()>0.5,row:2,col:1},{id:'e',value:e,isInput:Math.random()>0.5,row:2,col:2}];
         let vis=cells.filter(x=>!x.isInput).length;
         while(vis<3){ const i=randomInt(0,5); if(cells[i].isInput){cells[i].isInput=false; vis++;}}
         return cells;
      };

      const generateMemoryDeck = () => {
         const p = [{q:"-2+5",a:"3",v:3}, {q:"-3-2",a:"-5",v:-5}, {q:"-1+1",a:"0",v:0}, {q:"2Â·(-3)",a:"-6",v:-6}, {q:"-4-4",a:"-8",v:-8}, {q:"10:(-2)",a:"-5",v:-50}];
         const sel = p.sort(()=>Math.random()-0.5).slice(0,4);
         const c=[]; sel.forEach(x=>{c.push({id:`q-${x.v}`,content:x.q,matchId:x.v,isFlipped:false,isMatched:false},{id:`a-${x.v}`,content:x.a,matchId:x.v,isFlipped:false,isMatched:false})});
         return c.sort(()=>Math.random()-0.5);
      };

      const generateWordProblem = () => {
        const scenarios = [
            { t: 'elevator', f: () => { const s=randomInt(0,5), m=randomInt(2,6), e=s-m; return { text: `Igogailua ${s}. solairuan dago. ${m} solairu jaitsi ditu. Zein solairutan dago orain?`, correctAnswer: e, unit: 'solairuan', hint: `${s} - ${m} = ?` }; } },
            { t: 'temp', f: () => { const s=randomInt(-5,5), c=randomInt(2,8), d=Math.random()>0.5, e=d?s-c:s+c; return { text: `Tenperatura ${s}ÂºC-koa zen. Gero ${c}ÂºC ${d?'jaitsi' : 'igo'} da. Zein da tenperatura berria?`, correctAnswer: e, unit: 'ÂºC', hint: d?`${s}-${c}`:`${s}+${c}` }; } },
            { t: 'money', f: () => { const b=randomInt(10,50), d=randomInt(15,60); return { text: `Poltsikoan ${b}â‚¬ dituzu, baina ${d}â‚¬ zor dizkiozu. Saldo erreala?`, correctAnswer: b-d, unit: 'â‚¬', hint: `${b} - ${d}` }; } },
            { t: 'hist', f: () => { const b=randomInt(10,100), a=randomInt(30,80), e=-b+a; return { text: `Matematikari bat K.a. ${b}. urtean jaio zen eta ${a} urte bizi izan zen. Noiz hil zen?`, correctAnswer: e, unit: 'urtean', hint: `-${b} + ${a}` }; } },
            { t: 'sub', f: () => { const d=randomInt(10,50), x=randomInt(5,20); return { text: `Urpekari bat ${d}m-ko sakoneran dago. ${x}m gehiago jaitsi da.`, correctAnswer: -(d+x), unit: 'm', hint: `-${d} - ${x}` }; } },
            { t: 'game', f: () => { const p=randomInt(5,20), pen=randomInt(25,50); return { text: `Jokoan ${p} puntu zenituen, baina ${pen} kendu dizkizute.`, correctAnswer: p-pen, unit: 'pts', hint: `${p} - ${pen}` }; } }
        ];
        return { id: Math.random().toString(), ...scenarios[randomInt(0,5)].f() };
      };

      const generateNumberLinePoints = () => {
         const pts = [], used = new Set();
         ['A','B','C'].forEach(l => {
             let v = randomInt(-6,6); while(used.has(v)) v=randomInt(-6,6); used.add(v);
             pts.push({id:l, label:l, value:v});
         });
         return pts;
      };

      // --- COMPONENTS ---

      const LanguageSelector = ({ current, onChange }) => (
        <div className="flex items-center gap-2"><Globe size={18} className="text-slate-500"/><select value={current} onChange={e=>onChange(e.target.value)} className="bg-white border border-slate-200 text-slate-700 text-sm rounded-lg p-1.5"><option value="eu">Euskara</option><option value="es">EspaÃ±ol</option><option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option></select></div>
      );

      const AuthScreen = ({ lang, onLogin }) => {
        const [isReg, setIsReg] = useState(false);
        const [u, setU] = useState('');
        const [p, setP] = useState('');
        const [err, setErr] = useState('');
        const [ip, setIp] = useState('Wait...');
        const [did, setDid] = useState('');
        
        useEffect(() => {
           const d = StorageManager.getDeviceId();
           setDid(d);
           setIp(`Loc-${d.substr(4,4)}`);
           fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>setIp(d.ip)).catch(()=>{});
        }, []);

        const sub = async (e) => {
           e.preventDefault();
           if(!u || !p) return;
           if(isReg) {
              const r = await StorageManager.register(u, p, ip, did);
              if(r.success) onLogin(r.user); else setErr(r.error);
           } else {
              const r = await StorageManager.login(u, p, ip, did);
              if(r.success) onLogin(r.user); else setErr(r.error);
           }
        };

        const t = TRANSLATIONS[lang].auth;
        return (
           <div className="min-h-[80vh] flex items-center justify-center p-4">
              <div className="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full">
                 <h1 className="text-2xl font-bold text-center mb-6">{isReg ? t.register_title : t.login_title}</h1>
                 {!window.FIREBASE_CONFIG && <div className="mb-4 text-xs bg-yellow-50 text-yellow-700 p-2 rounded text-center">Modo Local (Sin Base de Datos)</div>}
                 <form onSubmit={sub} className="space-y-4">
                    <input className="w-full p-3 border rounded-xl" placeholder={t.user_ph} value={u} onChange={e=>setU(e.target.value)} />
                    <input className="w-full p-3 border rounded-xl" type="password" placeholder={t.pass_ph} value={p} onChange={e=>setP(e.target.value)} />
                    <div className="text-xs text-center text-slate-400">IP: {ip}</div>
                    {err && <div className="text-red-500 text-center font-bold">{err}</div>}
                    <button className="w-full py-3 bg-slate-800 text-white rounded-xl font-bold">{isReg ? t.btn_register : t.btn_login}</button>
                 </form>
                 <button onClick={()=>setIsReg(!isReg)} className="w-full mt-4 text-indigo-600 text-sm font-bold">{isReg ? t.has_account : t.no_account}</button>
              </div>
           </div>
        );
      };

      const AdminPanel = ({ lang, onLogout }) => {
          const [users, setUsers] = useState([]);
          const [delUser, setDelUser] = useState(null);
          const [showPass, setShowPass] = useState({});
          const [showLb, setShowLb] = useState(false);
          const [activeLb, setActiveLb] = useState('ops');
          const t = TRANSLATIONS[lang].admin;
          
          const games = ['ops','tf','pyr','compare','add','sub','mul','combined'];

          const load = async () => setUsers(await StorageManager.getAllUsers());
          useEffect(() => { load(); }, []);

          const doDel = async () => {
             if(delUser) {
                await StorageManager.deleteUser(delUser.username);
                await load();
                setDelUser(null);
             }
          };

          const togglePass = (u) => setShowPass(p => ({...p, [u]: !p[u]}));

          return (
             <div className="pb-10">
                <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">{t.title}</h2>
                    <div className="flex gap-2">
                        {db && <div className="flex items-center gap-1 bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold mr-2"><Cloud size={14}/> Cloud</div>}
                        {!db && <div className="flex items-center gap-1 bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold mr-2"><CloudOff size={14}/> Local</div>}
                        <button onClick={() => setShowLb(true)} className="bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 font-bold flex items-center gap-2"><BarChart2 size={16}/> {t.btn_leaderboards}</button>
                        <button onClick={onLogout} className="bg-slate-800 text-white px-4 py-2 rounded shadow hover:bg-slate-700">{t.logout}</button>
                    </div>
                </div>
                <div className="bg-white rounded-xl shadow overflow-x-auto">
                   <table className="w-full text-sm text-left">
                      <thead className="bg-slate-100 font-bold text-slate-700"><tr><th className="p-4">{t.col_user}</th><th className="p-4">{t.col_ip}</th><th className="p-4">{t.col_device}</th><th className="p-4">{t.col_pass}</th><th className="p-4">{t.col_score}</th><th className="p-4">{t.col_actions}</th></tr></thead>
                      <tbody>
                         {users.map(u => (
                            <tr key={u.username} className="border-t hover:bg-slate-50">
                               <td className="p-4 font-bold">{u.username}</td>
                               <td className="p-4 font-mono text-xs">{u.ip}</td>
                               <td className="p-4 font-mono text-xs text-slate-400" title={u.deviceId}>{u.deviceId ? u.deviceId.substring(0,8)+'...' : '-'}</td>
                               <td className="p-4 font-mono text-xs flex items-center gap-2">
                                  {showPass[u.username] ? u.password : 'â€¢â€¢â€¢â€¢â€¢â€¢'}
                                  <button onClick={()=>togglePass(u.username)} className="text-slate-400 hover:text-indigo-600">{showPass[u.username] ? <EyeOff size={14}/> : <Eye size={14}/>}</button>
                               </td>
                               <td className="p-4"><span className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">{Object.values(u.scores||{}).reduce((a,b)=>a+b,0)} pts</span></td>
                               <td className="p-4"><button onClick={()=>setDelUser(u)} className="bg-red-600 text-white px-3 py-1 rounded text-xs font-bold">{t.btn_ban}</button></td>
                            </tr>
                         ))}
                      </tbody>
                   </table>
                </div>
                
                {/* Delete Confirmation Modal */}
                {delUser && (
                   <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                      <div className="bg-white p-6 rounded-xl max-w-sm w-full m-4">
                         <h3 className="text-xl font-bold text-red-600 mb-2">{t.btn_ban} {delUser.username}</h3>
                         <p className="mb-6">{t.confirm_ban}</p>
                         <div className="flex justify-end gap-3">
                            <button onClick={()=>setDelUser(null)} className="px-4 py-2 font-bold text-slate-600">{t.btn_cancel}</button>
                            <button onClick={doDel} className="px-4 py-2 bg-red-600 text-white rounded font-bold">{t.btn_ban}</button>
                         </div>
                      </div>
                   </div>
                )}
                
                {/* Full Leaderboard Modal */}
                {showLb && (
                    <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                        <div className="bg-white w-full max-w-4xl max-h-[90vh] rounded-2xl flex flex-col shadow-2xl overflow-hidden">
                            <div className="p-5 border-b flex justify-between items-center bg-slate-50">
                                <h3 className="font-bold text-xl text-slate-800 flex items-center gap-2"><Trophy className="text-yellow-500"/> {t.lb_title}</h3>
                                <button onClick={() => setShowLb(false)} className="bg-slate-200 p-2 rounded-full hover:bg-slate-300 transition-colors"><X size={20}/></button>
                            </div>
                            <div className="p-4 border-b bg-white overflow-x-auto">
                                <div className="flex gap-2">
                                    {games.map(g => (
                                        <button 
                                          key={g} 
                                          onClick={() => setActiveLb(g)}
                                          className={`px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap transition-all ${activeLb === g ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                                        >
                                           {TRANSLATIONS[lang].records['game_'+g]}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="flex-grow overflow-y-auto bg-slate-50 p-6">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                    <table className="w-full text-left border-collapse">
                                        <thead className="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                                            <tr>
                                            <th className="p-4 w-20 text-center">#</th>
                                            <th className="p-4">{t.col_user}</th>
                                            <th className="p-4 text-right">{t.col_score}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {users
                                            .filter(u => u.scores && u.scores[activeLb] !== undefined)
                                            .sort((a,b) => b.scores[activeLb] - a.scores[activeLb])
                                            .map((u, i) => (
                                                <tr key={u.username} className="border-b border-slate-100 hover:bg-indigo-50/30 transition-colors">
                                                    <td className="p-4 text-center font-bold text-slate-500">
                                                        {i < 3 ? <span className={`w-8 h-8 rounded-full flex items-center justify-center text-white shadow-sm font-bold mx-auto ${i===0?'bg-yellow-400':i===1?'bg-slate-400':'bg-orange-400'}`}>{i+1}</span> : i+1}
                                                    </td>
                                                    <td className="p-4 font-bold text-slate-800">{u.username}</td>
                                                    <td className="p-4 text-right font-mono font-black text-indigo-600 text-lg">{u.scores[activeLb]}</td>
                                                </tr>
                                            ))}
                                            {users.filter(u => u.scores && u.scores[activeLb] !== undefined).length === 0 && (
                                                <tr><td colSpan="3" className="p-8 text-center text-slate-400 italic">Ez dago daturik (No data)</td></tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                )}
             </div>
          );
      };

      const Thermometer = ({ lang }) => {
          const t = TRANSLATIONS[lang].thermometer;
          const [temp, setTemp] = useState(5);
          const getHeight = (t) => Math.min(Math.max(((t + 20) / 60) * 100, 0), 100);
          const getColor = (t) => t > 25 ? 'bg-red-500' : t > 0 ? 'bg-green-400' : 'bg-blue-500';
          return (
            <div className="flex flex-col md:flex-row items-center justify-center gap-8 h-full">
              <div className="w-full md:w-1/2 space-y-4">
                <h3 className="text-xl font-bold text-slate-800">{t.title}</h3>
                <p className="text-slate-600 text-sm">
                  {t.desc}
                  <br/><br/>
                  {t.ref}
                  <ul className="list-disc ml-5 mt-2 space-y-1">
                    <li><span className="text-green-600 font-bold">{t.pos}</span></li>
                    <li><span className="text-blue-600 font-bold">{t.neg}</span></li>
                  </ul>
                </p>
                <div className="pt-4">
                  <label className="text-sm font-medium text-slate-700">{t.label}</label>
                  <input type="range" min="-20" max="40" value={temp} onChange={(e) => setTemp(parseInt(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer mt-2 accent-slate-800"/>
                </div>
                <div className="text-center p-4 bg-slate-50 rounded-xl border border-slate-200">
                   <span className="text-3xl font-bold text-slate-800">{temp > 0 ? `+${temp}` : temp}Â°C</span>
                   <p className="text-sm text-slate-500 mt-1">{temp > 0 ? t.above : temp < 0 ? t.below : t.zero}</p>
                </div>
              </div>
              <div className="relative h-64 w-16 bg-slate-200 rounded-full border-4 border-slate-300 flex justify-center shadow-inner">
                <div className="absolute right-0 top-0 h-full w-full flex flex-col justify-between py-4 pr-1 text-[10px] text-slate-400 font-mono items-end"><span>40</span><span>20</span><span>0</span><span>-20</span></div>
                <div className={`absolute bottom-2 w-8 rounded-t-lg rounded-b-full transition-all duration-300 ${getColor(temp)} shadow-[0_0_15px_rgba(0,0,0,0.1)]`} style={{ height: `${getHeight(temp)}%` }}>
                  <div className="absolute -top-8 left-1/2 transform -translate-x-1/2">
                    {temp < 0 ? <Snowflake size={20} className="text-blue-400 animate-pulse" /> : temp > 25 ? <Sun size={20} className="text-orange-500 animate-spin-slow" /> : null}
                  </div>
                </div>
                <div className="absolute bottom-[33.3%] w-full h-0.5 bg-slate-400 z-10 opacity-50 border-t border-dashed border-slate-600"></div>
              </div>
            </div>
          );
      };

      const ElevatorVisual = ({ lang }) => {
          const t = TRANSLATIONS[lang].elevator;
          const floors = [3, 2, 1, 0, -1, -2, -3];
          return (
            <div className="elevator-card text-white p-8 rounded-3xl shadow-xl flex flex-row items-center gap-8 h-full">
                <div className="flex-1 text-left">
                    <h2 className="text-3xl font-extrabold mb-4">{t.title}</h2>
                    <p className="opacity-90 text-sm leading-relaxed">
                        {t.desc}
                    </p>
                    <div className="mt-6 space-y-2">
                        <div className="bg-white/20 px-3 py-2 rounded-lg text-sm font-mono flex items-center gap-2">
                             <div className="bg-white text-blue-900 w-6 h-6 flex items-center justify-center font-bold rounded text-xs">0</div>
                             = {t.floor0}
                        </div>
                        <div className="bg-white/20 px-3 py-2 rounded-lg text-sm font-mono flex items-center gap-2">
                             <div className="bg-indigo-900 text-white w-6 h-6 flex items-center justify-center font-bold rounded text-xs">-1</div>
                             = {t.floor1}
                        </div>
                    </div>
                </div>
                <div className="bg-blue-900/30 p-2 rounded-2xl border border-blue-300/20 backdrop-blur-sm relative min-w-[100px]">
                    <div className="flex flex-col gap-1.5 relative z-10">
                        {floors.map(floor => (
                            <div key={floor} className="flex items-center gap-3">
                                <div className={`w-12 h-9 rounded-lg border-2 flex items-center justify-center font-mono font-bold text-lg shadow-sm
                                    ${floor === 0 ? 'bg-white border-white text-blue-900 z-10 scale-105' : 
                                      floor > 0 ? 'bg-transparent border-white/50 text-white' : 
                                      'bg-indigo-900/60 border-indigo-500/50 text-white'}`}>
                                    {floor}
                                </div>
                                <span className="text-[10px] uppercase font-bold tracking-wider opacity-80 w-12 text-left">
                                    {floor === 0 ? t.floor0 : floor > 0 ? `${floor}. ${t.floor_label}` : `${t.basement_label} ${Math.abs(floor)}`}
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
          );
      };

      const NumberLine = ({ lang }) => {
          const t = TRANSLATIONS[lang].numberline;
          const [hl, setHl] = useState(null);
          const range = Array.from({ length: 21 }, (_, i) => i - 10);
          return (
            <div className="w-full p-6 bg-white rounded-2xl shadow-sm border border-slate-100 my-6">
              <h3 className="text-xl font-bold text-slate-800 mb-4">{t.title}</h3>
              <p className="text-slate-600 mb-6 text-sm">{t.desc}</p>
              <div className="relative flex items-center justify-between h-24 px-4 overflow-x-auto md:overflow-hidden md:justify-center gap-1 md:gap-2 select-none">
                <div className="absolute w-full h-1 bg-slate-300 top-1/2 transform -translate-y-1/2 rounded-full z-0"></div>
                {range.map((num) => (
                  <div key={num} className="relative z-10 flex flex-col items-center group">
                    <div className={`w-1 h-4 mb-2 ${num % 5 === 0 ? 'h-6 bg-slate-800' : 'bg-slate-400'}`}></div>
                    <button onClick={() => setHl(num)} className={`w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 ${hl === num ? num < 0 ? 'bg-red-500 text-white scale-125 shadow-lg' : num > 0 ? 'bg-blue-500 text-white scale-125 shadow-lg' : 'bg-slate-800 text-white scale-125 shadow-lg' : 'bg-white border-2 border-slate-200 text-slate-500 hover:border-blue-300 hover:text-blue-500'}`}>
                      {num}
                    </button>
                    {hl === num && <div className="absolute -bottom-12 whitespace-nowrap text-xs font-medium bg-slate-800 text-white px-2 py-1 rounded">{num < 0 ? t.neg : num > 0 ? t.pos : t.zero}</div>}
                  </div>
                ))}
              </div>
              <div className="mt-12 flex justify-center gap-8 text-sm text-slate-500">
                <div className="flex items-center gap-2"><ArrowLeft size={16} /><span>{t.smaller}</span></div>
                <div className="flex items-center gap-2"><span>{t.bigger}</span><ArrowRight size={16} /></div>
              </div>
            </div>
          );
      };

      const NumberLineHunt = ({ lang }) => {
          const t = TRANSLATIONS[lang].numberline;
          const [pts, setPts] = useState(generateNumberLinePoints());
          const [inp, setInp] = useState({});
          const [chk, setChk] = useState(false);
          const check = () => setChk(true);
          return (
            <div className="bg-white p-6 rounded-2xl border border-slate-100">
                <div className="flex justify-between mb-6"><div className="text-left"><h3 className="font-bold text-lg">{t.hunt_title}</h3><p className="text-sm text-slate-500">{t.hunt_desc}</p></div><button onClick={()=>{setPts(generateNumberLinePoints()); setInp({}); setChk(false)}}><RefreshCw/></button></div>
                <div className="relative h-16 flex items-center justify-center mb-8 bg-slate-100 rounded-full overflow-hidden">
                     {[-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7].map(n => {
                         const p = pts.find(x=>x.value===n);
                         return <div key={n} className="flex-1 text-center text-xs relative border-l border-slate-300 h-full pt-6 text-slate-500">{n}{p && <div className="absolute top-1 left-1/2 -translate-x-1/2 bg-indigo-600 text-white w-5 h-5 rounded-full flex items-center justify-center font-bold text-xs shadow">{p.label}</div>}</div>;
                     })}
                </div>
                <div className="flex justify-center gap-4">
                    {pts.map(p => (
                        <div key={p.id} className="flex flex-col items-center">
                            <label className="font-bold text-indigo-900 mb-1">{p.label} =</label>
                            <input type="number" value={inp[p.id]||''} onChange={e=>{setChk(false); setInp({...inp,[p.id]:e.target.value})}} className={`w-16 h-12 text-center text-lg border-2 rounded-xl text-slate-800 font-bold ${chk ? (parseInt(inp[p.id])===p.value ? 'bg-green-100 border-green-500' : 'bg-red-100 border-red-500') : 'bg-white border-slate-200'}`} />
                        </div>
                    ))}
                </div>
                <div className="text-center mt-6"><button onClick={check} className="bg-slate-800 text-white px-6 py-2 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all">{t.check}</button></div>
            </div>
          );
      };

      const OperationsDrill = ({lang}) => {
          const t = TRANSLATIONS[lang].ops;
          const [m, setM] = useState('add');
          const [ex, setEx] = useState(generateOperation('add', lang));
          const [fb, setFb] = useState(null);
          
          const next = () => { setFb(null); setEx(m==='compare'?generateComparison():generateOperation(m, lang)); };
          useEffect(()=>{next()},[m]);
          
          const ans = (v) => { if(v===ex.correctAnswer){setFb('ok'); setTimeout(next,1000);}else setFb('no'); };
          
          return (
             <div className="space-y-6">
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-green-500 text-white p-4 rounded-xl text-center shadow-md">
                        <div className="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">{t.same}</div>
                        <div className="text-2xl font-black">+(+) â†’ +</div>
                    </div>
                    <div className="bg-green-500 text-white p-4 rounded-xl text-center shadow-md">
                        <div className="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">{t.same}</div>
                        <div className="text-2xl font-black">-(-) â†’ +</div>
                    </div>
                    <div className="bg-red-500 text-white p-4 rounded-xl text-center shadow-md">
                        <div className="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">{t.diff}</div>
                        <div className="text-2xl font-black">+(-) â†’ -</div>
                    </div>
                    <div className="bg-red-500 text-white p-4 rounded-xl text-center shadow-md">
                        <div className="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">{t.diff}</div>
                        <div className="text-2xl font-black">-(+) â†’ -</div>
                    </div>
                </div>

                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-8 text-center">
                    <div className="flex border-b mb-8">
                        {['compare','add','subtract','multiply','combined'].map(mod=><button key={mod} onClick={()=>setM(mod)} className={`flex-1 py-3 font-medium text-sm transition-colors border-b-2 ${m===mod?'border-slate-800 text-slate-800':'border-transparent text-slate-400 hover:text-slate-600'}`}>{t.modes[mod]}</button>)}
                    </div>
                    <h3 className="text-5xl font-mono font-bold mb-10 text-slate-800">{ex.question} <span className="text-slate-200">?</span></h3>
                    <div className="grid grid-cols-2 gap-4 max-w-sm mx-auto">
                        {ex.options.map((o,i)=><button key={i} onClick={()=>ans(o)} className="p-4 bg-white border-2 border-slate-100 rounded-xl font-bold text-2xl text-slate-700 hover:border-blue-500 hover:bg-blue-50 hover:-translate-y-1 transition-all shadow-sm">{o>0?`+${o}`:o}</button>)}
                    </div>
                    <div className="h-8 mt-6 font-bold text-lg">{fb==='ok'?<span className="text-green-500 animate-bounce block">{t.correct}</span>:fb==='no'?<span className="text-red-500 animate-shake block">{t.wrong}</span>:null}</div>
                    <div className="mt-4"><button onClick={next} className="text-slate-400 text-sm hover:text-slate-600 flex items-center gap-1 mx-auto">{t.skip} <ArrowRight size={14}/></button></div>
                </div>
             </div>
          );
      };

      const WordProblems = ({lang}) => {
          const t = TRANSLATIONS[lang].problems;
          const [p, setP] = useState(generateWordProblem());
          const [ans, setAns] = useState('');
          const [st, setSt] = useState('idle');
          const [h, setH] = useState(false);
          return (
             <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-full flex flex-col">
                 <p className="text-lg font-medium mb-6 flex-grow text-slate-700">{p.text}</p>
                 <div className="bg-slate-50 p-3 rounded-xl border border-slate-200 mb-4 flex gap-2">
                     <input type="number" value={ans} onChange={e=>{setSt('idle'); setAns(e.target.value)}} className="w-full bg-transparent outline-none text-xl font-bold text-slate-800" placeholder="?"/>
                     <span className="font-bold text-slate-400">{p.unit}</span>
                 </div>
                 {h && <div className="text-sm text-amber-600 mb-4 bg-amber-50 p-2 rounded border border-amber-100">{t.hint_prefix}: {p.hint}</div>}
                 <div className="flex justify-between items-center">
                     <button onClick={()=>setH(true)} className="text-xs text-amber-600 font-bold hover:underline"><Lightbulb size={14} className="inline"/> {t.hint_btn}</button>
                     <button onClick={()=>{ if(parseInt(ans)===p.correctAnswer) {setSt('ok'); setTimeout(()=>{setP(generateWordProblem());setAns('');setSt('idle');setH(false)},1500)} else setSt('no') }} className={`px-4 py-2 rounded-lg font-bold text-white transition-all shadow ${st==='ok'?'bg-green-500':st==='no'?'bg-red-500':'bg-slate-800 hover:bg-slate-700'}`}>{st==='ok'?t.correct:st==='no'?t.wrong:t.check}</button>
                 </div>
             </div>
          );
      };

      const MathPyramid = ({lang}) => {
          const t = TRANSLATIONS[lang].games.pyramid;
          const [c, setC] = useState(generatePyramid());
          const [inp, setInp] = useState({});
          const [st, setSt] = useState(null);
          const check = () => { const ok = c.every(x => !x.isInput || parseInt(inp[x.id]) === x.value); setSt(ok?'ok':'no'); };
          return (
             <div className="flex flex-col items-center gap-2">
                 {[0,1,2].map(r => <div key={r} className="flex gap-2">{c.filter(x=>x.row===r).sort((a,b)=>a.col-b.col).map(x=>(<div key={x.id} className="w-16 h-12 border-2 flex items-center justify-center font-bold rounded-lg shadow-sm bg-white">{x.isInput?<input type="number" className="w-full h-full text-center bg-indigo-50 text-indigo-900 font-bold outline-none" value={inp[x.id]||''} onChange={e=>setInp({...inp,[x.id]:e.target.value})}/>:<span className="text-slate-600">{x.value}</span>}</div>))}</div>)}
                 <button onClick={check} className="mt-4 bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold shadow-lg hover:shadow-indigo-200">{st==='ok'?'Oso ongi!':st==='no'?'Saiatu berriro':'Egiaztatu'}</button>
             </div>
          );
      };
      
      const TrueFalseGame = ({lang}) => {
          const t = TRANSLATIONS[lang].games.tf;
          const [q, setQ] = useState(generateTrueFalse());
          const [st, setSt] = useState(null);
          const guess = (v) => { setSt(v===q.isTrue?'ok':'no'); };
          const next = () => { setQ(generateTrueFalse()); setSt(null); };
          return (
             <div className="text-center">
                 <div className="text-4xl font-mono font-bold py-8 text-slate-800">{q.statement}</div>
                 {!st ? <div className="flex gap-4"><button onClick={()=>guess(false)} className="flex-1 bg-red-50 text-red-600 border border-red-100 py-4 rounded-2xl font-bold hover:bg-red-100 transition-colors flex flex-col items-center gap-2"><ThumbsDown/> {t.false}</button><button onClick={()=>guess(true)} className="flex-1 bg-green-50 text-green-600 border border-green-100 py-4 rounded-2xl font-bold hover:bg-green-100 transition-colors flex flex-col items-center gap-2"><ThumbsUp/> {t.true}</button></div>
                 : <div><div className={`font-bold mb-4 p-3 rounded-xl ${st==='ok'?'bg-green-100 text-green-800':'bg-red-100 text-red-800'}`}>{st==='ok'?'Zuzena!':'Okerra!'} {q.explanation}</div><button onClick={next} className="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold">Hurrengoa</button></div>}
             </div>
          );
      };

      const MemoryGame = ({lang}) => {
          const t = TRANSLATIONS[lang].games.memory;
          const [cds, setCds] = useState(generateMemoryDeck());
          const [sel, setSel] = useState([]);
          const click = (c) => {
              if(sel.length===2 || c.isFlipped || c.isMatched) return;
              const n = cds.map(x=>x.id===c.id?{...x,isFlipped:true}:x);
              setCds(n); setSel([...sel, c]);
              if(sel.length===1) {
                  setTimeout(()=>{
                      const m = sel[0].matchId === c.matchId;
                      setCds(prev=>prev.map(x=>(x.id===c.id||x.id===sel[0].id)?(m?{...x,isMatched:true}:{...x,isFlipped:false}):x));
                      setSel([]);
                  }, 1000);
              }
          };
          const allMatched = cds.length>0 && cds.every(c=>c.isMatched);
          return (
             <div className="flex flex-col items-center">
                 <div className="grid grid-cols-4 gap-3 mb-4 w-full">
                    {cds.map(c=><button key={c.id} onClick={()=>click(c)} className={`aspect-square rounded-xl flex items-center justify-center font-bold text-sm md:text-lg transition-all duration-300 ${c.isFlipped||c.isMatched?'bg-indigo-600 text-white shadow-lg rotate-y-180':'bg-slate-100 text-transparent hover:bg-slate-200'}`}>{c.content}</button>)}
                 </div>
                 {allMatched && <div className="text-green-600 font-bold animate-bounce">{t.won}</div>}
             </div>
          );
      };

      // Speed Game Components
      const SpeedOps = ({ q, onAnswer }) => (
          <div className="text-center w-full">
             <h3 className="text-4xl font-mono font-bold mb-8 text-slate-800" style={{direction: 'ltr'}}>{q.question}</h3>
             <div className="grid grid-cols-2 gap-4 max-w-sm mx-auto">
                {q.options.map((opt, i) => (<button key={i} onClick={() => onAnswer(opt)} className="p-4 bg-white border-2 border-slate-100 rounded-xl font-bold text-xl text-slate-700 hover:border-indigo-500 hover:bg-indigo-50 transition-all">{opt > 0 ? `+${opt}` : opt}</button>))}
             </div>
          </div>
      );
      const SpeedTF = ({ q, onAnswer, lang }) => (
          <div className="text-center w-full">
             <h3 className="text-4xl font-mono font-bold mb-8 text-slate-800" style={{direction: 'ltr'}}>{q.statement}</h3>
             <div className="flex gap-4 max-w-sm mx-auto">
                <button onClick={() => onAnswer(false)} className="flex-1 py-6 bg-red-50 text-red-600 border-2 border-red-100 rounded-2xl font-bold text-xl hover:bg-red-100 transition-colors"><ThumbsDown className="mx-auto mb-2"/> {TRANSLATIONS[lang].games.tf.false}</button>
                <button onClick={() => onAnswer(true)} className="flex-1 py-6 bg-green-50 text-green-600 border-2 border-green-100 rounded-2xl font-bold text-xl hover:bg-green-100 transition-colors"><ThumbsUp className="mx-auto mb-2"/> {TRANSLATIONS[lang].games.tf.true}</button>
             </div>
          </div>
      );
      const SpeedPyramid = ({ q, onAnswer, t_check }) => {
         const [inp, setInp] = useState({});
         const check = () => {
            const ok = q.cells.every(c => !c.isInput || parseInt(inp[c.id]) === c.value);
            onAnswer(ok);
         };
         return (
            <div className="flex flex-col items-center gap-2" style={{direction: 'ltr'}}>
               {[0,1,2].map(r => <div key={r} className="flex gap-2">{q.cells.filter(c=>c.row===r).sort((a,b)=>a.col-b.col).map(c=>(<div key={c.id} className="w-16 h-12 border-2 flex items-center justify-center font-bold rounded bg-white shadow-sm">{c.isInput ? <input type="number" className="w-full h-full text-center bg-indigo-50 font-bold text-indigo-900" value={inp[c.id]||''} onChange={e=>setInp({...inp,[c.id]:e.target.value})}/> : c.value}</div>))}</div>)}
               <button onClick={check} className="mt-6 px-8 py-3 bg-slate-800 text-white rounded-xl font-bold shadow-lg">{t_check}</button>
            </div>
         );
      };

      const ChallengeMode = ({ lang, user, onUpdateUser }) => {
         const [mode, setMode] = useState(null);
         const [play, setPlay] = useState(false);
         const [score, setScore] = useState(0);
         const [time, setTime] = useState(60);
         const [q, setQ] = useState(null);
         const [res, setRes] = useState(null);
         const [final, setFinal] = useState(null);
         const [lbs, setLbs] = useState({});
         
         const t = TRANSLATIONS[lang].records;
         
         useEffect(() => {
            const loadLbs = async () => {
               const allUsers = await StorageManager.getAllUsers();
               const newLbs = {};
               ['ops','tf','pyr','compare','add','sub','mul','combined'].forEach(gid => {
                  newLbs[gid] = allUsers.filter(u=>u.scores?.[gid] && !u.banned).sort((a,b)=>b.scores[gid]-a.scores[gid]).slice(0,3);
               });
               setLbs(newLbs);
            };
            loadLbs();
         }, [play]);

         useEffect(() => {
            if(play && time > 0) {
               const i = setInterval(() => setTime(t=>t-1), 1000);
               return () => clearInterval(i);
            }
            if(time === 0 && play) end();
         }, [play, time]);

         const start = (m) => { setMode(m); setScore(0); setTime(60); setPlay(true); setFinal(null); next(m); };
         
         const next = (m) => {
            setRes(null);
            if(m==='ops') setQ(Math.random()>0.5 ? generateOperation('combined', lang) : generateComparison());
            else if(m==='tf') setQ(generateTrueFalse());
            else if(m==='pyr') setQ({cells:generatePyramid(), id:Math.random()});
            else if(m==='compare') setQ(generateComparison());
            else if(m==='add') setQ(generateOperation('add'));
            else if(m==='sub') setQ(generateOperation('subtract'));
            else if(m==='mul') setQ(generateOperation('multiply'));
            else if(m==='combined') setQ(generateOperation('combined'));
         };

         const end = async () => {
            setPlay(false);
            const r = await StorageManager.saveScore(user.username, mode, score);
            setFinal({ score, isRecord: r.isNewRecord });
            if(r.isNewRecord) onUpdateUser(r.user);
         };

         const ans = (val) => {
            if(final) return;
            let ok = false;
            if(mode==='tf') ok = (val === q.isTrue);
            else if(mode==='pyr') ok = val;
            else ok = (val === q.correctAnswer);
            
            if(ok) { setScore(s=>s+1); setRes('ok'); setTimeout(()=>next(mode), 200); }
            else { setScore(s=>s-2); setRes('no'); setTimeout(()=>next(mode), 200); }
         };

         if(!play && !final) {
             const games = [
               {id:'ops',c:'bg-blue-500'},{id:'tf',c:'bg-green-500'},{id:'pyr',c:'bg-purple-500'},{id:'compare',c:'bg-orange-500'},
               {id:'add',c:'bg-teal-500'},{id:'sub',c:'bg-red-500'},{id:'mul',c:'bg-indigo-500'},{id:'combined',c:'bg-pink-500'}
             ];
             return (
                <div className="space-y-8 pb-10">
                   <div className="text-center"><h2 className="text-3xl font-bold">{t.title}</h2><p className="text-slate-500 mt-2">{t.subtitle}</p></div>
                   <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                      {games.map(g => (
                         <div key={g.id} className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-md transition-shadow">
                            <div className={`h-2 w-full ${g.c}`}></div>
                            <div className="p-6">
                               <div className="flex justify-between items-center mb-4">
                                   <h3 className="font-bold text-lg text-slate-800">{t['game_'+g.id]}</h3>
                                   <div className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-xs ${g.c}`}>
                                      {g.id === 'ops' ? <Calculator size={12}/> : g.id === 'tf' ? <CheckCircle size={12}/> : <Star size={12}/>}
                                   </div>
                               </div>
                               <div className="bg-slate-50 p-3 rounded-xl text-xs space-y-2 mb-6">
                                  <div className="font-bold text-slate-400 uppercase tracking-wider text-[10px]">TOP 3 SAILKAPENA</div>
                                  {lbs[g.id]?.length > 0 ? lbs[g.id].map((u,i)=>(
                                      <div key={i} className="flex justify-between items-center">
                                          <span className="text-slate-600 font-medium">{i+1}. {u.username}</span>
                                          <span className="font-black text-slate-800">{u.scores[g.id]}</span>
                                      </div>
                                  )) : <div className="text-slate-400 italic py-2">Oraindik ez dago markarik</div>}
                               </div>
                               <button onClick={()=>start(g.id)} className="w-full py-3 bg-slate-800 text-white font-bold text-sm rounded-xl hover:bg-slate-700 transition-colors flex items-center justify-center gap-2">
                                  {t.start} <ArrowRight size={14}/>
                               </button>
                            </div>
                         </div>
                      ))}
                   </div>
                </div>
             );
         }
         
         if(final) return <div className="text-center p-8 bg-white rounded-3xl shadow-xl max-w-md mx-auto border border-slate-100"><h2 className="text-3xl font-bold mb-4 text-slate-800">{final.isRecord ? t.new_record : t.final_score}</h2><div className="text-7xl font-black text-indigo-600 mb-8 tracking-tighter">{final.score}</div><button onClick={()=>setFinal(null)} className="bg-slate-800 text-white px-10 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all">{t.back}</button></div>;

         return (
            <div className="max-w-2xl mx-auto">
               <div className="flex justify-between bg-slate-800 text-white p-5 rounded-2xl mb-6 shadow-xl"><div className="font-mono text-2xl font-bold flex items-center gap-2"><Timer/>{time}s</div><div className={`font-mono text-3xl font-bold ${res==='ok'?'text-green-400':res==='no'?'text-red-400':''}`}>{score}</div></div>
               <div className="bg-white p-8 rounded-3xl shadow-xl border border-slate-100 relative min-h-[400px] flex items-center justify-center">
                  {res && <div className="absolute inset-0 bg-white/90 z-20 flex items-center justify-center animate-in fade-in duration-200">{res==='ok'?<CheckCircle size={80} className="text-green-500 animate-bounce"/>:<X size={80} className="text-red-500 animate-shake"/>}</div>}
                  <div className="w-full">
                      {['ops','compare','add','sub','mul','combined'].includes(mode) && <SpeedOps q={q} onAnswer={ans}/>}
                      {mode==='tf' && <SpeedTF q={q} onAnswer={ans} lang={lang}/>}
                      {mode==='pyr' && <SpeedPyramid q={q} onAnswer={ans} t_check={t.check}/>}
                  </div>
               </div>
            </div>
         );
      };

      const Profile = ({ lang, user, onLogout, onDelete }) => {
         const t = TRANSLATIONS[lang].profile;
         const [del, setDel] = useState(false);
         return (
            <div className="max-w-3xl mx-auto space-y-6">
               <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 flex flex-col md:flex-row items-center gap-6">
                  <div className="bg-slate-100 p-6 rounded-full"><User size={48} className="text-slate-400"/></div>
                  <div className="text-center md:text-left flex-grow">
                      <h2 className="text-3xl font-bold text-slate-800 mb-1">{user.username}</h2>
                      <button onClick={onLogout} className="text-red-500 text-sm font-bold flex items-center gap-1 mx-auto md:mx-0 hover:underline"><LogOut size={14}/> {t.logout}</button>
                  </div>
               </div>

               <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                  <h3 className="font-bold text-lg mb-6 flex gap-2 items-center text-slate-800"><Trophy className="text-yellow-500 fill-yellow-500"/> {t.best_scores}</h3>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                     {['ops','tf','pyr','compare','add','sub','mul','combined'].map(k => (
                         <div key={k} className={`p-4 rounded-2xl ${user.scores?.[k] ? 'bg-indigo-50 border border-indigo-100' : 'bg-slate-50 border border-slate-100'}`}>
                             <div className="text-[10px] font-bold uppercase tracking-widest mb-2 opacity-60 text-slate-600">{k}</div>
                             <div className={`text-2xl font-black ${user.scores?.[k] ? 'text-indigo-600' : 'text-slate-300'}`}>
                                 {user.scores?.[k] || '-'}
                             </div>
                         </div>
                     ))}
                  </div>
               </div>
               
               <div className="text-center pt-8">
                  {!del ? <button onClick={()=>setDel(true)} className="text-slate-400 hover:text-red-600 text-xs flex items-center justify-center gap-2 mx-auto transition-colors"><Trash2 size={12}/> {t.delete_acc}</button> : <div className="flex justify-center gap-4 items-center bg-red-50 p-4 rounded-xl inline-block border border-red-100"><span className="text-red-800 text-sm font-bold">{t.confirm_del}</span><button onClick={()=>setDel(false)} className="px-3 py-1 bg-white border border-red-200 text-red-800 rounded text-xs font-bold">Ez</button><button onClick={()=>onDelete(user.username)} className="px-3 py-1 bg-red-600 text-white rounded text-xs font-bold shadow">Bai</button></div>}
               </div>
            </div>
         );
      };

      const App = () => {
         const [sec, setSec] = useState('intro');
         const [menu, setMenu] = useState(false);
         const [lang, setLang] = useState('eu');
         const [user, setUser] = useState(null);

         useEffect(() => { 
            if(user && !user.isAdmin){
               const i = setInterval(async ()=>{
                  const s = await StorageManager.checkUserStatus(user.username);
                  if(s!=='ok'){ alert("KONTUA ITXITA / CUENTA CERRADA"); setUser(null); setSec('intro'); }
               }, 3000);
               return ()=>clearInterval(i);
            }
         }, [user]);

         const handleLogin = (u) => { setUser(u); setSec(u.isAdmin ? 'admin' : 'intro'); };
         
         if(!user) return <div className="min-h-screen bg-slate-50"><div className="flex justify-end p-4"><LanguageSelector current={lang} onChange={setLang}/></div><AuthScreen lang={lang} onLogin={handleLogin}/></div>;
         
         if(user.isAdmin) return <div className="min-h-screen bg-slate-50 p-4"><div className="max-w-7xl mx-auto"><div className="flex justify-between mb-4"><span>Admin Console</span><LanguageSelector current={lang} onChange={setLang}/></div><AdminPanel lang={lang} onLogout={()=>setUser(null)}/></div></div>;

         const NavBtn = ({id, icon, label}) => <button onClick={()=>{setSec(id); setMenu(false);}} className={`flex items-center gap-2 px-3 py-2 rounded-full text-sm font-bold transition-all ${sec===id?'bg-slate-800 text-white shadow-md':'text-slate-500 hover:bg-white hover:text-slate-800'}`}>{icon}{label}</button>;
         const t = TRANSLATIONS[lang];
         
         return (
            <div className={`min-h-screen bg-[#F8FAFC] flex flex-col text-slate-800 ${lang==='ar'?'font-arabic':''}`} dir={lang==='ar'?'rtl':'ltr'}>
               <nav className="sticky top-0 z-50 bg-white/80 backdrop-blur border-b border-slate-200/60">
                  <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                     <div className="flex items-center gap-2 font-bold text-xl cursor-pointer" onClick={()=>setSec('intro')}><div className="w-8 h-8 bg-indigo-600 text-white rounded-lg flex items-center justify-center font-bold shadow-indigo-200 shadow-md">Z</div><span className="hidden xl:inline tracking-tight text-slate-900">ZenbakiOsoak</span></div>
                     <div className="hidden lg:flex gap-1.5"><NavBtn id="intro" icon={<Home size={16}/>} label={t.nav.intro}/><NavBtn id="number_line" icon={<Layout size={16}/>} label={t.nav.line}/><NavBtn id="operations" icon={<Calculator size={16}/>} label={t.nav.ops}/><NavBtn id="problems" icon={<BookOpen size={16}/>} label={t.nav.probs}/><NavBtn id="games" icon={<Star size={16}/>} label={t.nav.games}/><NavBtn id="records" icon={<Trophy size={16}/>} label={t.nav.records}/><NavBtn id="profile" icon={<User size={16}/>} label={t.nav.profile}/><div className="w-px h-6 bg-slate-200 mx-2"></div><LanguageSelector current={lang} onChange={setLang}/></div>
                     <button className="lg:hidden p-2" onClick={()=>setMenu(!menu)}>{menu?<X/>:<Menu/>}</button>
                  </div>
                  {menu && <div className="lg:hidden bg-white border-b p-4 space-y-2"><NavBtn id="intro" icon={<Home/>} label={t.nav.intro}/><NavBtn id="records" icon={<Trophy/>} label={t.nav.records}/><NavBtn id="profile" icon={<User/>} label={t.nav.profile}/></div>}
               </nav>
               <main className="flex-grow max-w-7xl mx-auto w-full p-4 py-8">
                  {sec==='intro' && (
                     <div className="animate-in">
                        <div className="flex flex-col lg:grid lg:grid-cols-2 gap-8 items-stretch mt-8">
                            <div className="bg-white p-8 rounded-[40px] shadow-sm border border-slate-100">
                                <Thermometer lang={lang}/>
                            </div>
                            <div className="flex flex-col gap-6">
                                <ElevatorVisual lang={lang}/>
                                <div className="bg-white p-8 rounded-[40px] shadow-sm border border-slate-100 flex-grow">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-4">{t.sets.title}</h2>
                                    <p className="text-slate-600 text-sm mb-6">
                                        <strong>N</strong>: 0, 1, 2, 3...<br/>
                                        <strong>Z</strong>: ...-3, -2, -1, 0, 1, 2, 3...
                                    </p>
                                    <div className="relative h-32 w-full flex items-center justify-center">
                                        <div className="absolute w-64 h-24 border-2 border-purple-200 rounded-[50%] flex items-center justify-center z-0 bg-purple-50">
                                            <span className="text-purple-400 font-bold absolute top-2 right-6">Z</span>
                                        </div>
                                        <div className="absolute w-24 h-12 border-2 border-blue-300 rounded-[50%] flex items-center justify-center z-10 bg-white shadow-sm">
                                            <span className="text-blue-800 font-bold">N</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                     </div>
                  )}
                  {sec==='records' && <ChallengeMode lang={lang} user={user} onUpdateUser={setUser}/>}
                  {sec==='profile' && <Profile lang={lang} user={user} onLogout={()=>setUser(null)} onDelete={(u)=>{StorageManager.deleteUser(u); setUser(null);}}/>}
                  {sec==='number_line' && <div><NumberLine lang={lang}/><div className="my-8"><NumberLineHunt lang={lang}/></div></div>}
                  {sec==='operations' && <OperationsDrill lang={lang}/>}
                  {sec==='problems' && <div className="grid md:grid-cols-2 gap-6"><WordProblems lang={lang}/><WordProblems lang={lang}/><WordProblems lang={lang}/><WordProblems lang={lang}/></div>}
                  {sec==='games' && (
                     <div className="space-y-8 animate-in">
                        <div className="bg-white p-6 rounded-[32px] shadow-sm border border-slate-100">
                          <div className="mb-6 flex items-center gap-3">
                              <span className="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center text-white font-bold">1</span>
                              <h3 className="text-xl font-bold text-slate-700">{t.games.pyramid.title}</h3>
                          </div>
                          <div className="max-w-xl mx-auto bg-indigo-50/50 p-8 rounded-3xl border border-indigo-100"><MathPyramid lang={lang}/></div>
                        </div>
                        <div className="grid lg:grid-cols-2 gap-8">
                            <div className="bg-white p-6 rounded-[32px] shadow-sm border border-slate-100 h-full">
                                <div className="mb-6 flex items-center gap-3">
                                    <span className="w-8 h-8 bg-green-400 rounded-full flex items-center justify-center text-white font-bold">2</span>
                                    <h3 className="text-xl font-bold text-slate-700">{t.games.tf.title}</h3>
                                </div>
                                <div className="bg-slate-50 p-6 rounded-3xl border border-slate-100"><TrueFalseGame lang={lang}/></div>
                            </div>
                            <div className="bg-white p-6 rounded-[32px] shadow-sm border border-slate-100 h-full">
                                <div className="mb-6 flex items-center gap-3">
                                    <span className="w-8 h-8 bg-purple-400 rounded-full flex items-center justify-center text-white font-bold">3</span>
                                    <h3 className="text-xl font-bold text-slate-700">{t.games.memory.title}</h3>
                                </div>
                                <div className="bg-slate-50 p-6 rounded-3xl border border-slate-100"><MemoryGame lang={lang}/></div>
                            </div>
                        </div>
                     </div>
                  )}
               </main>
            </div>
         );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
